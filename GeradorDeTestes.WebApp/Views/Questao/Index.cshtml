@model VisualizarQuestoesViewModel

@{
	ViewBag.Titulo = "Visualização de Questões";

	var questoesAgrupadas = Model.Registros.GroupBy(q => q.NomeDisciplina);

	NotificacaoViewModel? notificacao = ViewData[nameof(NotificacaoViewModel)] as NotificacaoViewModel;
}

<div class="d-grid d-lg-flex flex-wrap gap-2 w-50 align-items-center">
	<a class="botao px-5" title="Nova Questão" asp-action="Cadastrar">
		<i class="bi bi-journal-plus"></i>
		Nova Questão
	</a>
	<a class="botao botao-outline px-4" asp-action="PrimeiraEtapaGerar">
		<i class="bi bi-suit-diamond"></i>
		Gerar Questões com IA
	</a>
	<a class="botao botao-outline px-5" title="Voltar para Listagem" asp-controller="Home" asp-action="Index">
		<i class="bi bi-arrow-left"></i>
		Voltar
	</a>
</div>

<hr class="border border-white opacity-25" />

@if (notificacao is not null)
{
	<div class="alert alert-danger alert-dismissible fade show my-3" role="alert">
		<h6>@notificacao.Titulo</h6>
		@notificacao.Mensagem
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
	</div>
}

<div class="row g-2">
    @if (!Model.Registros.Any())
    {
        <p class="fw-semibold mt-3">Ainda não há nenhuma questão cadastrada...</p>
    }
    else
	{
		@foreach (var grupo in questoesAgrupadas)
	{
			<h4 class="cor-padrao my-4">@grupo.Key</h4>
			@foreach (DetalhesQuestaoViewModel questao in Model.Registros)
			{
				<div class="col-12 col-md-5 col-lg-4 col-xl-3 mb-3">
					<div class="card rounded-4 border-0">
						<div class="card-body cor-padrao">
							<div class="d-flex justify-content-between mb-4">
								<p class="card-text mb-1 text-truncate" style="max-width: 75%;">
									<span class="fw-semibold">@questao.NomeMateria</span>
								</p>
								<p class="card-text mb-1 opacity-25">
									<span class="fw-semibold">@questao.Id.ToString().Substring(0, 8)</span>
								</p>
							</div>
							<p class="card-text mb-1">
								<span>@questao.Enunciado</span>
							</p>

							<p class="card-text mb-1">
							</p>
								@foreach (AlternativaQuestaoViewModel alternativa in questao.Alternativas)
								{
									@if (alternativa.EstaCorreta)
									{
										<p class="card-text mb-1">
											<span class="fw-semibold">Alternativa Correta:</span> @alternativa.Texto
										</p>
									}
								}
							<span class="d-flex gap-1 justify-content-end">
								<a class="botao rounded-circle" title="Detalhes Questão" asp-action="Detalhes" asp-route-id="@questao.Id">
									<i class="bi bi-eye"></i>
								</a>
								<a class="botao rounded-circle" title="Editar Questão" asp-action="Editar" asp-route-id="@questao.Id" asp-route-contexto="Index">
									<i class="bi bi-pencil-square"></i>
								</a>
								<a class="botao-excluir botao-excluir-outline rounded-circle" title="Excluir Questão" asp-action="Excluir" asp-route-id="@questao.Id">
									<i class="bi bi-trash3"></i>
								</a>
							</span>
						</div>
					</div>
				</div>
			}
		}
	}
</div>